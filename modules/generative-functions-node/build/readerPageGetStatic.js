"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(n,o){function i(e){try{u(a.next(e))}catch(e){o(e)}}function s(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}u((a=a.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var r,a,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],a=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.readerPageGetStaticPaths=exports.readerPageGetStaticProps=void 0;var getReaderPageProps_1=require("./getReaderPageProps"),fs_util_1=require("fs-util"),k_explore_1=require("k-explore"),get_path_1=require("get-path"),fs_util_js_1=require("fs-util-js"),js_util_1=require("js-util"),readerPageGetStaticProps=function(e){return __awaiter(void 0,void 0,void 0,(function(){var t,r,a,n,o,i;return __generator(this,(function(s){switch(s.label){case 0:return(0,get_path_1.getProjectRoot)()?(t=process.env.NEXT_PUBLIC_BASEPATH,r=null===(i=e.params)||void 0===i?void 0:i.queryPath,a=r?(0,js_util_1.makeArray)(r):[],n=a.join("/"),o=js_util_1.omitUndefinedValues,[4/*yield*/,(0,getReaderPageProps_1.getReaderPageProps)(t||"",n,!1)]):(
// NB: this can happen on revalidation and blocked static requests, because we aren't using .projectRoot file anywhere. It's fine
console.log("NO PROJECTROOT"),[2/*return*/,{props:{notFound:!0,notFoundReason:"This file cannot be found."}}]);case 1:return[2/*return*/,o.apply(void 0,[s.sent()])]}}))}))};exports.readerPageGetStaticProps=readerPageGetStaticProps;
/**
 * NB: I can't do this with a fallback , because next.js doesn't include my docs folder into the bundle.
 *
 * A solution could be to add the docs folder into the next.js folder or copy it...
 *
 * https://github.com/vercel/next.js/discussions/32236?sort=new#discussioncomment-3029649
 *
 * Ther are other workarounds here to make sure it ends up in the bundle.
 *
 */
var readerPageGetStaticPaths=function(){return __awaiter(void 0,void 0,void 0,(function(){var e,t,r;return __generator(this,(function(a){switch(a.label){case 0:return e=process.env.NEXT_PUBLIC_BASEPATH,(t=(0,get_path_1.getProjectRoot)())?(r=e?fs_util_1.path.join(t,e):t,[4/*yield*/,(0,k_explore_1.explore)({basePath:r,includeFoldersWithResults:!0})]):(console.log("NO PROJECTROOT"),[2/*return*/,{fallback:"blocking",paths:[]}]);case 1:
// for now, let's just generate the props every time. later we can fetch the actual paths here, but that would require lots of calculation, so this might actually be fine since it will cache the result. We can also make the page load until the props are provided. I need to read the docs about it to make it all super smooth
return[2/*return*/,{paths:a.sent().map((function(e){return e.path})).map((function(e){return{params:{queryPath:(0,fs_util_js_1.makeRelative)(e,r).split("/")}}})),
// TODO: Maybe needs to be "false"?
fallback:"blocking"}]}}))}))};exports.readerPageGetStaticPaths=readerPageGetStaticPaths;
//# sourceMappingURL=readerPageGetStatic.js.map